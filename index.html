



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Reefer Container Predictive Maintenance</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#reefer-predictive-maintenance-solution" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="." title="Reefer Container Predictive Maintenance" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Reefer Container Predictive Maintenance
            </span>
            <span class="md-header-nav__topic">
              Introduction
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/refarch-reefer-ml/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="." title="Reefer Container Predictive Maintenance" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Reefer Container Predictive Maintenance
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/refarch-reefer-ml/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Introduction
      </label>
    
    <a href="." title="Introduction" class="md-nav__link md-nav__link--active">
      Introduction
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#component-view" title="Component view" class="md-nav__link">
    Component view
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requisites-to-build-and-run-this-solution" title="Pre-requisites to build and run this solution" class="md-nav__link">
    Pre-requisites to build and run this solution
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#be-sure-to-have-event-stream-or-kafka-running-somewhere" title="Be sure to have Event Stream or Kafka running somewhere" class="md-nav__link">
    Be sure to have Event Stream or Kafka running somewhere
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#provision-a-postgresql-service" title="Provision a Postgresql service" class="md-nav__link">
    Provision a Postgresql service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-environment-variables" title="Set environment variables" class="md-nav__link">
    Set environment variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-a-python-development-environment-as-docker-image" title="Building a python development environment as docker image" class="md-nav__link">
    Building a python development environment as docker image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-docker-image-for-jupyter-notebook" title="Build the docker image for Jupyter notebook" class="md-nav__link">
    Build the docker image for Jupyter notebook
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-approach" title="Project approach" class="md-nav__link">
    Project approach
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-collect-data" title="1- Collect data" class="md-nav__link">
    1- Collect data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-define-the-predictive-scoring-model" title="2- Define the predictive scoring model" class="md-nav__link">
    2- Define the predictive scoring model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-deploy-the-model" title="3- Deploy the model" class="md-nav__link">
    3- Deploy the model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-deploy-each-service" title="4- Deploy each service" class="md-nav__link">
    4- Deploy each service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="collect-data/" title="Collect data" class="md-nav__link">
      Collect data
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="/#2-define-the-predictive-scoring-model" title="Define the predictive scoring model" class="md-nav__link">
      Define the predictive scoring model
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="build-run/" title="Build and run the solution on Openshift" class="md-nav__link">
      Build and run the solution on Openshift
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="integration-tests/" title="Run integration tests" class="md-nav__link">
      Run integration tests
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="predictive-maintenance/" title="Reefer predictive maintenance problem" class="md-nav__link">
      Reefer predictive maintenance problem
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-kc/" title="Reefer solution implementation project" class="md-nav__link">
      Reefer solution implementation project
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#component-view" title="Component view" class="md-nav__link">
    Component view
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requisites-to-build-and-run-this-solution" title="Pre-requisites to build and run this solution" class="md-nav__link">
    Pre-requisites to build and run this solution
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#be-sure-to-have-event-stream-or-kafka-running-somewhere" title="Be sure to have Event Stream or Kafka running somewhere" class="md-nav__link">
    Be sure to have Event Stream or Kafka running somewhere
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#provision-a-postgresql-service" title="Provision a Postgresql service" class="md-nav__link">
    Provision a Postgresql service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-environment-variables" title="Set environment variables" class="md-nav__link">
    Set environment variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-a-python-development-environment-as-docker-image" title="Building a python development environment as docker image" class="md-nav__link">
    Building a python development environment as docker image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-docker-image-for-jupyter-notebook" title="Build the docker image for Jupyter notebook" class="md-nav__link">
    Build the docker image for Jupyter notebook
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-approach" title="Project approach" class="md-nav__link">
    Project approach
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-collect-data" title="1- Collect data" class="md-nav__link">
    1- Collect data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-define-the-predictive-scoring-model" title="2- Define the predictive scoring model" class="md-nav__link">
    2- Define the predictive scoring model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-deploy-the-model" title="3- Deploy the model" class="md-nav__link">
    3- Deploy the model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-deploy-each-service" title="4- Deploy each service" class="md-nav__link">
    4- Deploy each service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/refarch-reefer-ml/edit/master/docs/index.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="reefer-predictive-maintenance-solution">Reefer Predictive Maintenance Solution</h1>
<p>This project is to demonstrate how to perform real time analytics, like predictive maintenance of Reefer container in the shipping industry, using Reefer container metric event stream. </p>
<p>!!! note:
        This project is part of the <a href="https://ibm-cloud-architecture.github.io/refarch-kc/">reference implementation solution</a>  to demonstrate the IBM <a href="https://ibm-cloud-architecture.github.io/refarch-eda">event driven reference architecture</a>.</p>
<p>The runtime environment in production may look like in the following diagram:</p>
<p><img alt="" src="images/RT-analytics.png" /></p>
<p>The Reefer container is a IoT device, which emits container metrics every 15 minutes via the MQTT protocol. The first component receiving those messages is Apache Nifi to transform the metrics message to a kafka event. Kafka is used as the event backbone and event sourcing so microservices, deployed on openshift, can consume and publish messages.</p>
<p>For persistence reason, we may leverage big data type of storage like Cassandra to persist the container metrics over a longer time period. This datasource is used by the Data Scientists to do its data preparation and build training and test sets and build model.</p>
<p>Data scientists can run Jupyter lab on OpenShift and build a model to be deployed as python microservice, consumer of kafka Reefer metrics events. The action will be to change the state of the Reefer entity via an events to the <code>containers</code> topic. </p>
<h2 id="component-view">Component view</h2>
<p>For the minimum viable demonstration the runtime components looks like in the figure below:</p>
<p><img alt="" src="images/mvp-runtime.png" /></p>
<ol>
<li>
<p>A web app, deployed on Openshift, is running a simulator to simulate the generation of Reefer container metrics while the container is at sea or during end to end transportation. The app exposes a simple POST operation with a control object to control the simulation. Here is an example of such control.json</p>
<div class="codehilite"><pre><span></span><span class="p">{</span> <span class="err">&#39;containerID&#39;:</span> <span class="err">&#39;c100&#39;,</span>
<span class="err">&#39;simulation&#39;:</span> <span class="err">&#39;co2sensor&#39;,</span>
<span class="err">&#39;nb_of_records&#39;:</span> <span class="err">1000,</span>
<span class="err">&#39;good_temperature&#39;:</span> <span class="err">4.4</span>
<span class="p">}</span>
</pre></div>

<p>See <a href="#the-simulator-as-webapp">this section to build and deploy</a> the simulator web app.</p>
</li>
<li>
<p>A curl script will do the post of this json object. <a href="#test-sending-a-simulation-control-to-the-post-api">See this paragraph.</a></p>
</li>
<li>The metrics events are sent to the <code>containerMetrics</code> topic in Kafka.</li>
<li>The predictive scoring is a consumer of such events, read one event at a time and call the model internally, then sends a new event when maintenance is required. <a href="/#the-predictive-scoring-agent">See the note</a> for details.</li>
<li>The maintenance requirement is an event in the <code>containers</code> topic.</li>
<li>The last element is to trace the container maintenance event, in real application, this component should trigger a business process to get human performing the maintenance. The <a href="">following repository</a> is the microservice we could use on as this component, but we have a simple consumer in the <code>consumer</code> folder.</li>
</ol>
<p>For the machine learning environment we can use csv file as input data or postgresql database. The environment looks like in the figure below:</p>
<p><img alt="" src="images/data-collect.png" /></p>
<p>The simulator can run as a standalone tool to create training and test data to be saved in a remote postgresql database. We use postgresql as a service on IBM cloud. The service has credential with URL and SSL certificate.</p>
<p><img alt="" src="images/postgres-credential.png" /></p>
<h2 id="pre-requisites-to-build-and-run-this-solution">Pre-requisites to build and run this solution</h2>
<p>Start by cloning this project using the command:</p>
<div class="codehilite"><pre><span></span>git clone https://github.com/ibm-cloud-architecture/refarch-reefer-ml
</pre></div>

<h3 id="be-sure-to-have-event-stream-or-kafka-running-somewhere">Be sure to have Event Stream or Kafka running somewhere</h3>
<p>We recommend creating the Event Stream service using the <a href="https://cloud.ibm.com/catalog/services/event-streams">IBM Cloud catalog</a>, you can also read our <a href="https://ibm-cloud-architecture.github.io/refarch-eda/deployments/eventstreams/es-ibm-cloud/">quick article</a> on this event stream cloud deployment. We also have deployed Event Stream on Openshift running on-premise servers following the product documentation <a href="https://ibm.github.io/event-streams/installing/installing-openshift/">here</a>. </p>
<p>The following diagram illustrates the topics configured in IBM Cloud Event Stream service:</p>
<p><img alt="" src="images/es-topics.png" /></p>
<p>With IBM Cloud deployment use the service credentials to create new credentials to get the Kafka brokers list, the admin URL and the api key needed to authenticate the consumers or producers.</p>
<p>For Event Streams on Openshift deployment, click to the <code>connect to the cluster</code> button to get the broker URL and to generate the API key: select the option to generate the key for all topics.</p>
<p><img alt="" src="images/cluster-access.png" /></p>
<h3 id="provision-a-postgresql-service">Provision a Postgresql service</h3>
<p>Use the <a href="https://cloud.ibm.com/docs/services/databases-for-postgresql">product documentation</a> to provision your own service. Define service credential and use the <code>composed</code> url, the database name and the SSL certificate. Use the following commands to get the certificate:</p>
<div class="codehilite"><pre><span></span>ibmcloud login
ibmcloud cdb cacert &lt;database deployment name&gt;
</pre></div>

<h3 id="set-environment-variables">Set environment variables</h3>
<p>As part of the <a href="https://12factor.net/">12 factors practice</a>, we externalize the end points configuration in environment variables. We are providing a script template (<code>scripts/setenv-tmp.sh</code>) to set those variables for your local development. Rename this file as <code>setenv.sh</code>. This file is git ignored, to do not share keys and passwords in public domain.</p>
<p>The variables help the different code in the solition to access the Event Stream broker cluster and the Postgresql service running on IBM Cloud.</p>
<h3 id="building-a-python-development-environment-as-docker-image">Building a python development environment as docker image</h3>
<p>To avoid impacting our laptop environment (specially macbook which use python), we use a dockerfile to get the basic of python 3.7.x and the python modules like kafka, http requests, pandas, sklearn, pytest... we need to develop and test the different python code of this solution. To build your python image with all the needed libraries, use the following commands:</p>
<div class="codehilite"><pre><span></span>cd docker
docker build -f docker-python-tools -t ibmcase/python .
</pre></div>

<p>To use this python environment you can use the script: <code>startPythonEnv</code>. If you run with Event Stream on the cloud and Postgresql  on your laptopn use the LOCAL argument, use  IBMCLOUD otherwise:</p>
<div class="codehilite"><pre><span></span># refarch-reefer-ml project folder
./startPythonEnv.sh IBMCLOUD
</pre></div>

<h3 id="build-the-docker-image-for-jupyter-notebook">Build the docker image for Jupyter notebook</h3>
<p>We are using a special version of conda to add the postgresql and kafka libraries for python so we can access postgresql or kafka from notebook. The Dockerfile may use a <code>cert.pem</code> file, which contains the postgres certificate so the notebook can connect to postgresql service wiith SSL connection. </p>
<div class="codehilite"><pre><span></span>cd docker 
docker build -f docker-jupyter-tool -t ibmcase/jupyter .
</pre></div>

<p>To run this jupyter server run:</p>
<div class="codehilite"><pre><span></span># refarch-reefer-ml project folder
./startJupyterServer.sh IBMCLOUD
</pre></div>

<h2 id="project-approach">Project approach</h2>
<p>As a major step of developing a machine learning or analytics model, it is important to have good data. In this project we are adopting a lightweight approach to develop this minimum viable product. The activities are summarized in this diagram:</p>
<p><img alt="" src="images/lightweight-process-model-figure2.png" /></p>
<p>We encourage you to read <a href="https://ibm-cloud-architecture.github.io/refarch-data-ai-analytics/methodology/lightweight/">this article</a> for more insight on the methodology.</p>
<h3 id="1-collect-data">1- Collect data</h3>
<p>We are using a simulator to generate data and go over the detail of how to collect data in <a href="collect-data/">this article</a>.</p>
<p>If you generate the training and test sets as file, put this .csv file under the <code>ml/data/</code> folder.</p>
<p>If you use postgresql as data source be sure to have set the POSTGRES environment variables in the <code>setenv.sh</code> script.</p>
<h3 id="2-define-the-predictive-scoring-model">2- Define the predictive scoring model</h3>
<p>Predictive maintenance and anomaly detection are complex problems to address. We do not pretend to address those complex problems in this repository, as we focus in putting in place the end to end creation and deployment of the model. To review the problem of predictive maintenance read <a href="predictive-maintenance/">this article.</a></p>
<p><em>If you want to contribute to build a better model, we are looking for contributors</em>.</p>
<p>To build the model and work on the data, we will use a local version of <strong>Jupyter</strong> notebook to load the logistic regression nodebook from the <code>ml</code> folder. </p>
<p>We have two types of notebook</p>
<ol>
<li>
<p>Start a jupyter server using our docker image and a postgresql in IBM cloud.</p>
<div class="codehilite"><pre><span></span>pwd

./startJupyterServer IBMCLOUD  or LOCAL
</pre></div>

</li>
<li>
<p>Then open a web browser to <code>http://localhost:8888?token=&lt;sometoken&gt;</code> go under <code>work/ml</code> folder.</p>
</li>
<li>
<p>Open one of the model:</p>
<ul>
<li>the <code>model_logistic_regression.ipynb</code> to work on data set saved in the <code>ml/data/telemetries.csv</code> file. </li>
<li>the <code>model_logistic_regression-pg.ipynb</code> to work on data saved in postgresql running on IBM Cloud.</li>
</ul>
<p>The notebooks include comments to explain how the model is done. We use logistic regression to build a binary classification (maintenance required or not), as the data are simulated, and the focus is not in the model building, but more on the end to end process.</p>
<p>The notebook persists the trained model as a pickle file so it can be loaded by a python module or another notebook.</p>
<p>For more information on using the Jupyter notebook, here is a <a href="https://jupyter-docker-stacks.readthedocs.io/en/latest/index.html">product documentation</a>.</p>
<ul>
<li>The co2 sensor plot over time shows the training data with some sporadic behavior:</li>
</ul>
<p><img alt="" src="images/co2sensor-plot.png" /></p>
<ul>
<li>The confusion matrix shows very little false positive and false negative:</li>
</ul>
<p><img alt="" src="images/confusion-mtx.png" /></p>
</li>
<li>
<p>Use the model in another notebook: We can use a second notebook to test the model with one telemetry record using the pickle serialized model. The notebook is named <code>predictMaintenance.ipynb</code>.</p>
</li>
</ol>
<h3 id="3-deploy-the-model">3- Deploy the model</h3>
<p>We have two types of deployment:</p>
<ul>
<li>Run the model in a web app to support REST calls.</li>
<li>Run the model in an agent, consumer of reefer telemetry events and producer of container maintenance event.</li>
</ul>
<p>The <code>scoring</code> folder includes an <code>eventConsumer</code> folder for the agent implementation and a <code>webapp</code> for the Flask and REST end point wrapper. </p>
<p>In this solution we use the agent implementation.</p>
<p>So you need to copy the generated pickle file to the <code>eventConsumer/domain</code> folder and if you use the webapp too, copy it to <code>webapp/domain</code>.</p>
<h3 id="4-deploy-each-service">4- Deploy each service</h3>
<p>See <a href="build-run/">this detailed note</a> to deploy each service on openshift.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
        
          <a href="collect-data/" title="Collect data" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Collect data
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"."}})</script>
      
    
  </body>
</html>